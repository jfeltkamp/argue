<?php

/**
 * @file
 * Contains argue_structure.module.
 */

use Drupal\Core\Routing\RouteMatchInterface;

/**
 * Implements hook_help().
 */
function argue_structure_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    // Main module help for the argue_structure module.
    case 'help.page.argue_structure':
      $output = '';
      $output .= '<h3>' . t('About') . '</h3>';
      $output .= '<p>' . t('Argue basic structure of rule tree and user groups.') . '</p>';
      return $output;

    default:
      return '';
  }
}

/**
 * Implements hook_theme().
 */
function argue_structure_theme() {

  return [
    'argue_structure_listitem' => [
      'variables' => [
        'url' => NULL,
        'icon' => NULL,
        'line_1' => NULL,
        'line_2' => NULL,
        'meta' => NULL,
        'meta_attributes' => NULL,
      ],
    ],
    'argue_structure_list' => [
      'variables' => [
        'attributes' => NULL,
        'content' => NULL,
      ]
    ],
    'argue_structure_proscons_pill' => [
      'variables' => [
        'pro' => NULL,
        'con' => NULL,
      ]
    ],
    'argue_structure_nested_list' => [
      'variables' => [
        'attributes' => NULL,
        'label' => NULL,
        'link' => NULL,
        'level' => NULL,
        'node_list' => NULL,
        'items' => NULL,
      ]
    ],
  ];
}

/**
 * Implements hook_preprocess_node()
 *
 * Prepare pills with the number of arguments pro and con a rule.
 */
function argue_structure_preprocess_node(&$vars) {

  /** @var \Drupal\argue_proscons\EvaluatingService $eval */
  $eval = \Drupal::service('argue_proscons.evaluating_service');
  if(isset($vars['node']) && $vars['node']->bundle() == 'rule') {
    $result = $eval->getRuleArgumentCounts($vars['node']->id());
    $vars['content']['meta'] = [
      '#theme' => 'argue_structure_proscons_pill',
      '#pro' => $result['pro'],
      '#con' => $result['con'],
    ];
  }
}

/**
 * Implements hook_form_FORM_ID_alter().
 */
function argue_structure_form_user_form_alter(&$form, \Drupal\Core\Form\FormStateInterface $form_state, $form_id) {
  if(isset($form['account']['name']['#title'])) {
    $form['account']['name']['#title'] = t('First and last name');
  }
}
